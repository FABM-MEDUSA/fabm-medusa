check_conservation: true
instances:
  light:
    model: medusa/medusa_light
    coupling:
      ZCHN: pelagic/ZCHN
      ZCHD: pelagic/ZCHD
#  nflux:
#    model: constant_surface_flux
#    use: false
#    parameters:
#      flux: 1.6e-10
#    coupling:
#      target: medusa_pelagic/ZFER
  gas_transfer:
    model: medusa/gas_transfer
    parameters:
      eqn: 7                    #choice of gas transfer coefficients, default = 7
                                # 1 Liss & Merlivat (1986)    [approximated]
                                # 2 Wanninkhof (1992)         [sans enhancement]
                                # 3 Nightingale et al. (2000) [good]
                                # 4 Nightingale et al. (2000) [better]
                                # 5 Nightingale et al. (2000) [best]
                                # 6 OCMIP-2                   [sans variability]
                                # 7 Wanninkhof (2014)         [assumes 6h avg winds]
  carbonate:
    model: medusa/medusa_carbonate
    use: false
    coupling:
      ZDIC: pelagic/ZDIC
      ZALK: pelagic/ZALK
      kw660: gas_transfer/kw660
  oxygen:
    model: medusa/medusa_oxygen
    coupling:
      ZOXY: pelagic/ZOXY
      kw660: gas_transfer/kw660
  pelagic:
    model: medusa/medusa_pelagic
    parameters:
      xxi: 0.01257              # C:N conversion factor (mol N g C-1), default=0.01257
      xaln: 15.0                # chl-specific initial slope of P-I curve (non-diatoms) (g C(g chl)-1 (W m-2)-1 d-1), default=15.0
      xald: 11.25               # chl-specific initial slope of P-I curve (diatoms) (g C(g chl)-1 (W m-2)-1 d-1), default=11.25
      jliebig: false            # Liebig''s minimum law for nutrient limitation, 'jliebig'), default= false
      xnln: 0.5                 # N nutrient uptake half-saturation constant (non-diatoms) (mmol N m-3), default=0.5	
      xfln: 0.00033             # Fe nutrient uptake half-saturation constant (non-diatoms) (mmol Fe m-3), default=0.00033
      xnld: 0.75                # N nutrient uptake half-saturation constant (non-diatoms) (mmol N m-3), default=0.75
      xsld: 3.0                 # Si nutrient uptake half-saturation constant (diatoms) (mmol Si m-3), default=3.0	
      xfld: 0.00067             # Fe nutrient uptake half-saturation constant (diatoms) (mmol Fe m-3), default=0.00067
      xvpn: 0.640 #0.53                # Maximum phytoplankton growth rate (non-diatoms) (d-1), default=0.53
      xvpd: 0.6 #0.50                # Maximum phytoplankton growth rate (diatoms) (d-1), default=0.50
      jphy: 1                   # Temperature regulation (phyto growth), 1-Eppley,2-q10,default=1
      jq10: 1.5                 # q10 factor for temperature regulation option 2, default=1.5
      xsin0: 0.2                # minimum diatom Si:N ratio (mol Si mol N-1), default=0.2
      xnsi0: 0.2                # minimum diatom N:Si ratio (mol N mol Si-1), default=0.2
      xuif: 1.5                 # hypothetical growth ratio at Inf Si:N ratio, default=1.5
      xthetam: 0.05             # maximum Chl:C ratio (non-diatoms) (g chl g C-1), default=0.05
      xthetamd: 0.05            # maximum Chl:C ratio (diatoms) (g chl g C-1), default=0.05
      xkmi: 0.8                 # microzooplankton grazing half-saturation constant (mmol N m-3), default=0.8
      xpmipn: 0.75              # microzooplankton grazing preference on non-diatoms, default=0.75
      xpmid: 0.25               # microzooplankton grazing preference on detritus, default=0.25
      xkme: 0.3                 # mesozooplankton grazing half-saturation constant (mmol N m-3), default=0.3
      xpmepn: 0.15              # mesozooplankton grazing preference on non-diatoms, default=0.15
      xpmepd: 0.35              # mesozooplankton grazing preference on diatoms, default=0.35
      xpmezmi: 0.35             # mesozooplankton grazing preference on microzooplankton, default=0.35
      xpmed: 0.15               # mesozooplankton grazing preference on detritus, default=0.15
      xgmi: 2.0                 # maximum microzooplankton grazing rate (d-1), default=2.0
      xgme: 0.5                 # maximum mesozooplankton grazing rate (d-1), default=0.5	
      xthetad: 6.625            # detritus C:N ratio (mol C mol N-1), default=6.625
      xphi: 0.20                # zooplankton grazing inefficiency, default=0.20
      xthetapn: 6.625           # phytoplankton C:N ratio (non-diatoms) (mol C mol N-1), default=6.625
      xthetapd: 6.625           # phytoplankton C:N ratio (diatoms) (mol C mol N-1), default=6.625
      xbetan: 0.77              # zooplankton N assimilation efficiency, default=0.77
      xthetazmi: 5.625          # microzooplankton C:N ratio (mol C mol N-1), default=5.625	
      xbetac: 0.64              # zooplankton C assimilation efficiency, default=0.64
      xkc: 0.8                  # zooplankton net C growth efficiency, default=0.8
      xthetazme: 5.625          # mesozooplankton C:N ratio (mol C mol N-1), default=5.625
      xmetapn: 0.02             # phytoplankton loss rate (non-diatoms) (d-1), default=0.02
      xmetapd: 0.02             # phytoplankton loss rate (diatoms) (d-1), default=0.02
      xmetazmi: 0.02            # microzooplankton loss rate (d-1), default=0.02
      xmetazme: 0.02            # mesozooplankton loss rate (d-1), default=0.02
      xmpn: 0.1                 # phytoplankton maximum loss rate (non-diatoms) (d-1), default=0.1
      xmpd: 0.1                 # phytoplankton maximum loss rate (diatoms) (d-1), default=0.1
      xmzmi: 0.1                # microzooplankton maximum loss rate (d-1), default=0.1
      xmzme: 0.2                # mesozooplankton maximum loss rate (d-1), default=0.2
      xkphn: 0.5                # phytoplankton loss half-saturation constant (non-diatoms) (mmol N m-3), default=0.5
      xkphd: 0.5                # phytoplankton loss half-saturation constant (diatoms) (mmol N m-3), default=0.5
      xkzmi: 0.5                # microzooplankton loss half-saturation constant (mmol N m-3), default=0.5
      xkzme: 0.75               # mesozooplankton loss half-saturation constant (mmol N m-3), default=0.75
      jmpn: 3                   # mortality formulation (non-diatoms), 1-linear, 2-quadratic, 3-hyperbolic, 4-sigmoid', default=3
      jmpd: 3                   # mortality formulation (diatoms), 1-linear, 2-quadratic, 3-hyperbolic, 4-sigmoid', default=3
      jmzmi: 3                  # mortality formulation (non-diatoms), 1-linear, 2-quadratic, 3-hyperbolic, 4-sigmoid', default=3
      jmzme: 3                  # mortality formulation (non-diatoms), 1-linear, 2-quadratic, 3-hyperbolic, 4-sigmoid', default=3
      jmd: 2                    # Temperature regulation (detritus remin), 1-Eppley,2-q10',default=1
      xmd: 0.0190 #0.0158               # detrital N remineralisation rate (d-1), default=0.0158
      xmdc: 0.0152 #0.0127              # detrital C remineralisation rate (d-1), default=0.0127
      xsdiss: 0.006             # diatom frustule dissolution rate (d-1), default=0.006
      xfdfrac1: 0.333            # fast detritus fraction of diatom losses, default=0.33
      xfdfrac2: 1.              # fast detritus fraction of mesozooplankton losses, default=1.
      xfdfrac3: 0.8             # fast detritus fraction of mesozooplankton grazing, default=0.8
      xrfn: 30.0e-6                # phytoplankton Fe:N uptake ratio (mmol Fe mol N-1 m), default=0.03
      xridg_r0: 0.026           # CaCO3:POC export rain ratio scalar, Ridgwell et al (2007), default=0.026
      xthetanit: 2.0            # O2 consumption by N remineralisation (mol O_2 mol N-1), default=2.0
      xthetarem: 1.1226         # O2 consumption by C remineralisation (mol O_2 mol C-1), default=1.1226
      xo2min: 4.0               # minimum O2 concentration (mmol O_2 m-3), default=4.0
      wg: -2.999808 #-2.5                  # detritus sinking rate (m d-1), default = -2.5
      wdep: 2.999808 # -wg
    initialization:
      ZCHN: 0.01
      ZCHD: 0.01
      ZPHN: 0.01
      ZPHD: 0.01
      ZPDS: 0.01
      ZDIN: 30.0
      ZFER: 1.0e-4
      ZSIL: 90.0
      ZDET: 0.01
      ZDTC: 0.06625
      ZZMI: 0.01
      ZZME: 0.01
      ZALK: 2450.
      ZDIC: 2330.
      ZOXY: 175.
    coupling:
      tempn: fast_detritus/tempn
      tempc: fast_detritus/tempc
      tempsi: fast_detritus/tempsi
      tempfe: fast_detritus/tempfe
      tempca: fast_detritus/tempca
      om_cal: zero #carbonate/Om_cal
      ZSEDFE: benthic/ZSEDFE
      ZSED: Q6/surface
  iron_scavenging:
    model: medusa/medusa_iron_scav
    parameters:
      xk_FeL: 100.              # dissociation constant for (Fe+ligand) (mmol m-3)-1, default=0.1
      xLgT: 1.                  # total ligand concentration (mmol m-3), default=0.001	
      xk_sc_Fe: 1.e-3           # scavenging rate of "free" Fe (d-1), default=0.001
      jiron: 1              # iron scavenging scheme, 1-Dutkiewicz et al. (2005),2-Moore et al. (2004),3-Moore et al. (2008),4-Galbraith et al. (2010)',default=1
    coupling:
      ZFER: pelagic/ZFER
      ffastc_loc: fast_detritus/ffastc_loc
      ffastsi_loc: fast_detritus/ffastsi_loc
      ffastca_loc: fast_detritus/ffastca_loc
      fscal_part: pelagic/fscal_part
  fast_detritus:
    model: medusa/medusa_fast_detritus
    parameters:
      xfe_sed: 0. #0.000228
      iball: 1                 # ballast model formulation (1- ballast model (Yool et al., 2011), 2- ballast-sans-ballast model), default = 1
      seafloor: 3 #1              # seafloor handling (1-inorganic returns, 2-organic returns, 3-couple benthos (nothing to do in this model), default = 1
      xrfn: 30.0e-6               # phytoplankton Fe:N uptake ratio (mmol Fe mol N-1 m), default=0.03
    coupling:
      ZOXY: pelagic/ZOXY
      ZDIN: pelagic/ZDIN
      ZSIL: pelagic/ZSIL
      ZFER: pelagic/ZFER
      ZDIC: pelagic/ZDIC
      ZDET: pelagic/ZDET
      ZDTC: pelagic/ZDTC
      ZALK: pelagic/ZALK
      ZSED: Q6/surface
      ZSEDCA: benthic/ZSEDCA
      ZSEDFE: benthic/ZSEDFE
      om_cal: zero #carbonate/Om_cal
  benthic:
    model: medusa/medusa_benthic
    use: true
    parameters:
      xsedc: 0.05
      xsedn: 0.05
      xsedfe: 0.05
      xsedsi: 0.01
      xsedca: 0.01
      xrfn: 30.0e-6
    initialization:
      ZSEDC: 0.
      ZSEDN: 0.
      ZSEDFE: 0.
      ZSEDSI: 0.
      ZSEDCA: 0.
      ZSEDFE: 0.
    coupling:
      ZDIN: pelagic/ZDIN
      ZSIL: pelagic/ZSIL
      ZFER: pelagic/ZFER
      ZDIC: pelagic/ZDIC
      ZDET: pelagic/ZDET
      ZDTC: pelagic/ZDTC
      ZOXY: pelagic/ZOXY
      ZALK: pelagic/ZALK
  Q6:
    long_name: benthic particulate organic matter
    model: ersem/benthic_column_particulate_matter
    use: true
    parameters:
      composition: cnpsf                                   # elemental composition
      resuspension: false                                  # enable resuspension, default = false
    # vel_crit: 0.02                                       # critical shear velocity for resuspension (m/s), default = 0.02
      c0: 0.001                                            # background carbon concentration (mg C/m^2), default = 0.0
    initialization:
      c: 3052.0                                            # carbon (mg C/m^2)
      n: 3.5                                               # nitrogen (mmol N/m^2)
      p: 0.5                                               # phosphorus (mmol P/m^2)
      s: 149.0                                             # silicate (mmol Si/m^2)
      pen_depth_c: 0.0173                                  # penetration depth of carbon (m)
      pen_depth_n: 0.02                                    # penetration depth of nitrogen (m)
      pen_depth_p: 0.025                                   # penetration depth of phosphorus (m)
      pen_depth_s: 0.0313                                  # penetration depth of silicate (m)
#    coupling:
#      RP: zero
  ben_col:
    long_name: benthic column
    model: ersem/benthic_column
    use: true
    parameters:
      qPW: 0.4                                             # sediment porosity (-)
      EDZ_mix: 20.0                                        # equilibrium diffusive speed between sediment surface water (d/m)
      d_tot: 0.3                                           # depth of sediment column (m)
      Etur: 2e-06                                          # basal bioturbation rate (m^2/d)
      mtur: 10.0                                           # maximum relative turbation enhancement (-)
      htur: 116.0                                          # Michaelis-Menten constant for bioturbation (mg C/m^2/d)
      dtur: 0.02                                           # bioturbation depth (m)
      EDZ_1: 5e-05                                         # diffusivity in oxygenated layer (m^2/d)
      EDZ_2: 5e-05                                         # diffusivity in oxidized layer (m^2/d)
      EDZ_3: 5e-05                                         # diffusivity in anoxic layer (m^2/d)
      irr_min: 2.0                                         # minimum diffusion enhancement through bioirrigation (-)
      mirr: 10.0                                           # maximum relative diffusion enhancement due to bioirrigation (-)
      hirr: 101.0                                          # Michaelis-Menten constant for bioirrigation (mg C/m^2/d)
    initialization:
      D1m: 0.009                                           # depth of bottom interface of oxygenated layer (m)
      D2m: 0.05                                            # depth of bottom interface of oxidized layer (m)
  pco2a:
    model: horizontal_constant
    parameters:
      value: 400.
      standard_name: mole_fraction_of_carbon_dioxide_in_air
  Q6s_aerobic:
    long_name: aerobic particulate silicate
    model: ersem/benthic_column_particulate_matter_layer
    parameters:
      composition: s                                       # elemental composition
      minimum_depth: 0.0                                   # minimum depth (m), default = 0.0
      variable_maximum_depth: true                         # maximum depth is variable, default = false
      remin: 0.007                                         # remineralization rate (1/d), default = 0.0
    coupling:
      Q: Q6
      s_remin_target: zero_hz #K5/per_layer/s1
      maximum_depth: ben_col/D1m                           # maximum depth (m)
  Q6s_anaerobic:
    long_name: anaerobic particulate silicate
    model: ersem/benthic_column_particulate_matter_layer
    parameters:
      composition: s                                       # elemental composition
      variable_minimum_depth: true                         # minimum depth is variable, default = false
      maximum_depth: 0.3                                   # maximum depth (m), default = 0.0
      remin: 0.007                                         # remineralization rate (1/d), default = 0.0
      source_depth_distribution: 2                         # vertical distribution of changes (1: constant absolute rate, 2: constant relative rate, 3: constant carbon-based relative rate), default = 1
    coupling:
      Q: Q6
      s_remin_target: zero_hz #K5/per_layer/s2
      minimum_depth: ben_col/D1m                           # minimum depth (m)
  G2:
    long_name: benthic oxygen
    model: ersem/benthic_column_dissolved_matter
    parameters:
      composition: o                                       # composition (any combination of c,n,p,s,o,a)
      last_layer: 1                                        # sediment layer where concentration drops to zero, default = 3
      relax: 5.0                                           # rate of relaxation towards equilibrium concentration profile (1/d)
      minD: 0.0001                                         # minimum depth of zero-concentration isocline (m)
    initialization:
      o: 0.0225                                            # oxygen (mmol/m^2)
    coupling:
      o_pel: pelagic/ZOXY                                          # pelagic oxygen (mmol/m^3)
  H1:
    long_name: benthic aerobic bacteria
    model: ersem/benthic_bacteria
    parameters:
      qnc: 0.0167                                          # nitrogen to carbon ratio (mmol N/mg C)
      qpc: 0.00125                                         # phosphorus to carbon ratio (mmol P/mg C)
      c0: 1e-06                                            # background concentration (mg C/m^2), default = 0.0
      q10: 2.0                                             # Q_10 temperature coefficient (-)
      dd: 0.001                                            # Michaelis-Menten constant for oxygen limitation through layer thickness (m)
      nfood: 2                                             # number of food sources
      su1: 0.0005                                          # base affinity for food source 1 (m^2/mg C/d)
      su2: 2e-05                                           # base affinity for food source 2 (m^2/mg C/d)
      suf2: 0.0002                                         # additional affinity for food source 2 subject to nutrient limitation (m^2/mg C/d), default = 0.0
      puinc2: 2.0                                          # affinity for nutrients relative to carbon in food source 2 (-), default = 1.0
      pue2: 0.1                                            # fraction of consumed food source 2 that is excreted (-), default = 0.0
      pur: 0.3                                             # fraction of consumed carbon that is respired (-)
      sr: 0.02                                             # specific rest respiration (1/d)
      pdQ1: 0.1                                            # fraction of dying matter that is dissolved (-)
      sd: 0.05                                             # specific maximum mortality related to oxygen limitation (1/d)
    initialization:
      c: 25.0                                              # carbon (mg C/m^2)
    coupling:
      Q1: Q1
      Q6: H1_Q6
      food1: Q1
      food2: H1_Q6
      Dm: ben_col/D1m                                      # depth interval available to bacteria (m)
      K4n: zero_hz #K4/per_layer/n1_pw                              # ammonium (mmol N/m^2)
      K1p: zero_hz #K1/per_layer/p1_pw                              # phosphate (mmol N/m^2)
      G2o: G2/per_layer/o1                                 # oxygen (mmol O_2/m^2)
      G3c: zero_hz #G3/per_layer/c1                                 # dissolved inorganic carbon (mmol C/m^2)
      benTA: zero_hz                                       # benthic alkalinity (mEq/m^2)
  H1_Q6:
    long_name: benthic aerobic bacteria POM
    model: ersem/benthic_column_particulate_matter_layer
    parameters:
      composition: cnps                                    # elemental composition
      minimum_depth: 0.0                                   # minimum depth (m), default = 0.0
      variable_maximum_depth: true                         # maximum depth is variable, default = false
    coupling:
      Q: Q6
      maximum_depth: ben_col/D1m
  Q1:
    long_name: benthic dissolved organic matter
    model: ersem/benthic_base
    parameters:
      composition: cnp                                     # elemental composition
      c0: 0.001                                            # background carbon concentration (mg C/m^2), default = 0.0
